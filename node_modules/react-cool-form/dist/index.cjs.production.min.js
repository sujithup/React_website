"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("@babel/runtime/helpers/extends"),t=require("react"),n=require("dequal/lite");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=u(e),a=u(r),i=function(e){var r=t.useRef(e);return t.useEffect((function(){r.current=e})),r},o=function(e){return e.reduce((function(e,r){return e[r]=!0,e}),{})},l=function(e){return null!==e&&"object"==typeof e},s=function(e){return e instanceof FileList},f=function e(r){if(r instanceof Event)throw new Error("Unable to clone event.");if(!l(r)||s(r))return r;if(r instanceof Date)return new Date(r.getTime());if(Array.isArray(r))return r.map((function(r){return e(r)}));if(l(r))return Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{});throw new Error("Unable to clone object.")},d=function(e){return e.filter(Boolean)},v=function(e){return!Array.isArray(e)&&!(e instanceof Date)&&l(e)},y=function e(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],c=t[n];Array.isArray(u)&&Array.isArray(c)?r[n]=[].concat(u,c):v(u)&&v(c)?r[n]=e(u,c):r[n]=c})),r}),{})},b=function(e){return void 0===e},h=function e(r,t){return v(r)?Object.keys(r).reduce((function(n,u){var c=e(r[u],t[u]||!1);return b(c)?delete n[u]:n[u]=c,n}),{}):t?r:void 0},m=function(e){if("string"!=typeof e)throw new TypeError("Expected a string.");return e.length?d(e.split(/[.[\]]+/)):[]},p=function(e,r,t){if(!v(e)||!r)return t;var n=m(r).reduce((function(e,r){return(e||{})[r]}),e);return b(n)?t:n},k=function(e){return"function"==typeof e},g=function(e){return k(e)&&"AsyncFunction"===e.constructor.name},E=function(e){return"checkbox"===e.type},C=function(e){return v(e)&&!Object.keys(e).length},A=function(e){return/INPUT|TEXTAREA|SELECT/.test(e.tagName)},w=function(e){return"file"===e.type},R=function(e){return"select-multiple"===e.type},j=function(e){return"radio"===e.type},O=function(e,r,t,n){if(void 0===n&&(n=!1),!v(e))throw new TypeError("Expected an object.");var u=m(r),c=n?f(e):e;return u.slice(0,-1).reduce((function(e,r,t){var n=!Number.isNaN(Number(u[t+1]));return v(e[r])&&!n||(e[r]=n?[]:{}),e[r]}),c)[u[u.length-1]||""]=t,c},V=function(e,r,t){if(void 0===t&&(t=!1),!v(e))throw new TypeError("Expected an object.");var n=t?f(e):e,u=n;if(u.hasOwnProperty(r))return delete u[r],n;var c=m(r);if(!c.length)return n;var a=c.pop(),i=c.reduce((function(e,r){return(e||{})[r]}),u);return l(i)&&i.hasOwnProperty(a)&&delete i[a],n},D=function(e,r){var u=t.useReducer((function(e){return e+1}),0)[1],c=t.useRef(e),o=t.useRef({}),l=i(r||function(){}),s=t.useCallback((function(e,r,t){var i=void 0===t?{}:t,s=i.fieldPath,f=i.shouldUpdate,d=void 0===f||f,y=e.split(".")[0];if(y){if("values"!==e&&"values"===y||!n.dequal(p(c.current,e),r)){var b=O(c.current,e,r,!0),h=b.errors,m=b.dirty,k=b.isDirty,g=b.isValid,E=b.submitCount,A="dirty"===y?function(e){return!!function e(r,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(r);n<u.length;n++){var c=u[n];if(!0===c)return t.push(c),t;v(c)&&e(c,t)}return t}(e).length}(m):k,w="errors"===y?C(h):g,R="isSubmitting"===y&&r?E+=1:E;c.current=a.default({},b,{isDirty:A,isValid:w,submitCount:R}),e=s||e,d&&(Object.keys(o.current).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||o.current.isDirty&&A!==k||o.current.isValid&&w!==g)&&(u(),l.current(c.current))}}else n.dequal(c.current,r)||(c.current=r,u(),l.current(c.current))}),[l]),f=t.useCallback((function(e,r){void 0===r&&(r=!1),r?delete o.current[e]:o.current[e]=!0}),[]);return{stateRef:c,setStateRef:s,setUsedStateRef:f}},S="undefined"==typeof window?t.useEffect:t.useLayoutEffect;exports.get=p,exports.set=O,exports.unset=V,exports.useForm=function(e){var r=void 0===e?{}:e,n=r.defaultValues,u=void 0===n?{}:n,l=r.validate,f=r.validateOnChange,m=void 0===f||f,T=r.validateOnBlur,x=void 0===T||T,L=r.builtInValidationMode,P=void 0===L?"message":L,N=r.shouldRemoveField,q=void 0===N||N,U=r.excludeFields,F=void 0===U?[]:U,M=r.onReset,W=r.onSubmit,B=r.onError,I=r.debug,_=t.useRef(!0),X=t.useRef(null),z=t.useRef({}),G=t.useRef({}),H=t.useRef({}),J=t.useRef(o(F)),K=t.useRef(),Q=i(l),Y=t.useRef({}),Z=i(M||function(){}),$=i(W||function(){}),ee=i(B||function(){}),re=t.useRef(u),te=t.useRef({values:re.current,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),ne=D(te.current,I),ue=ne.stateRef,ce=ne.setStateRef,ae=ne.setUsedStateRef,ie=t.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e,t=r.type,n=r.name,u=r.dataset.rcfExclude;return!/button|image|submit|reset/.test(t)&&(!(u&&!n)&&(H.current[n]||!(u||J.current[n])))})).reduce((function(e,r){var t=r,n=t.name;return e[n]=a.default({},e[n],{field:r}),(E(t)||j(t))&&(e[n].options=e[n].options?[].concat(e[n].options,[r]):[r]),e}),{})}),[]),oe=t.useCallback((function(e,r,t,n){return ce(e,V(t,n,!0),{fieldPath:r})}),[ce]),le=t.useCallback((function(e){return function(r){if(null!=r&&r.name&&!H.current[r.name]&&!J.current[r.name])if(k(e))Y.current[r.name]=e;else{var t=e.validate,n=c.default(e,["validate"]);t&&(Y.current[r.name]=t),G.current[r.name]=n}}}),[]),se=t.useCallback((function(e){var r,t=z.current[e],n=t.field,u=t.options,c=n.value;if("INPUT"===n.tagName){var a,i;if(null!=(a=G.current[e])&&a.valueAsNumber)return c=n.valueAsNumber;if(null!=(i=G.current[e])&&i.valueAsDate)return c=n.valueAsDate}if((function(e){return"number"===e.type}(n)||function(e){return"range"===e.type}(n))&&(c=n.valueAsNumber||""),E(n))if(u){var o=u;c=u.length>1?o.filter((function(e){return e.checked})).map((function(e){return e.value})):o[0].checked}else{var l=p(ue.current.values,n.name);Array.isArray(l)?(l=new Set(l),n.checked?l.add(c):l.delete(c),c=Array.from(l)):c=n.checked}return j(n)&&u&&(c=(null==(r=u.find((function(e){return e.checked})))?void 0:r.value)||""),R(n)&&!u&&(c=Array.from(n.options).filter((function(e){return e.selected})).map((function(e){return e.value}))),w(n)&&(c=n.files),c}),[ue]),fe=t.useCallback((function(e,r){if(z.current[e]&&!H.current[e]){var t=z.current[e],n=t.field,u=t.options;if(E(n)){var c=u;c.length>1?c.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):c[0].checked=!!r}else j(n)?u.forEach((function(e){e.checked=e.value===r})):R(n)&&Array.isArray(r)?Array.from(n.options).forEach((function(e){e.selected=!!r.includes(e.value)})):w(n)?(s(r)&&(n.files=r),r||(n.value="")):n.value=null!=r?r:""}}),[]),de=t.useCallback((function(e,r){b(p(te.current.values,e))&&(te.current.values=O(te.current.values,e,r,!0),ce("values."+e,p(te.current.values,e),{shouldUpdate:!_.current}))}),[ce]),ve=t.useCallback((function(e,r,t){return void 0===r&&(r=!1),void 0===t&&(t=Object.values(z.current)),t.forEach((function(t){var n=v(t)?t.field.name:t;if(!H.current[n]){var u=p(e,n);if(b(u)||fe(n,u),r){var c=p(re.current,n);de(n,b(c)?se(n):c)}}}))}),[se,de,fe]),ye=t.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.target,u=t.watch,c=void 0===u||u,a=t.errorWithTouched,i=void 0!==a&&a;if(e){var o,l=function(e){return e=n?n+"."+e:e,c&&ae(e),e},s=function(e,r){return c&&i&&e.startsWith("errors")&&r&&!C(r)?(e=e.replace("errors","touched"),ae(e),h(r,p(ue.current,e))):r};if(Array.isArray(e))o=e.map((function(e){return e=l(e),s(e,p(ue.current,e))}));else if(v(e)){var f=e;o=Object.keys(f).reduce((function(r,t){return e=l(f[t]),r[t]=s(e,p(ue.current,e)),r}),{})}else e=l(e),o=s(e,p(ue.current,e));return o}}),[ae,ue]),be=t.useCallback((function(e,r){(r=k(r)?r(p(ue.current.errors,e)):r)?ce("errors."+e,r):oe("errors","errors."+e,ue.current.errors,e)}),[oe,ce,ue]),he=t.useCallback((function(e){e?Array.isArray(e)?e.forEach((function(e){return oe("errors","errors."+e,ue.current.errors,e)})):oe("errors","errors."+e,ue.current.errors,e):ce("errors",{})}),[oe,ce,ue]),me=t.useCallback((function(e){if(!1!==P&&z.current[e]){var r=z.current[e].field;if("message"===P)return r.validationMessage;for(var t in r.validity)if("valid"!==t&&r.validity[t])return t}}),[P]),pe=t.useCallback((function(){return!1===P?{}:Object.keys(z.current).reduce((function(e,r){var t=me(r);return e=a.default({},e,t?O({},r,t):{})}),{})}),[P,me]),ke=t.useCallback((async function(e){if(Y.current[e])try{return await Y.current[e](p(ue.current.values,e),ue.current.values)}catch(e){throw e}}),[ue]),ge=t.useCallback((function(){var e=Object.keys(Y.current).map((function(e){return ke(e)}));return Promise.all(e).then((function(e){return Object.keys(Y.current).reduce((function(r,t,n){return r=a.default({},r,e[n]?O({},t,e[n]):{})}),{})}))}),[ke]),Ee=t.useCallback((async function(e){if(!Q.current)return e?void 0:{};try{var r=await Q.current(ue.current.values);return e?p(r,e):v(r)?r:{}}catch(e){throw e}}),[Q,ue]),Ce=t.useCallback((async function(e){var r=g(Q.current)||g(Y.current[e]);r&&ce("isValidating",!0);try{var t=await Ee(e)||await ke(e)||me(e);return be(e,t),r&&ce("isValidating",!1),t}catch(e){return e}}),[Q,me,ke,Ee,be,ce]),Ae=t.useCallback((function(e){return r=function(){return Ce(e)},(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(r,{timeout:2e3});var r}),[Ce]),we=t.useCallback((function(){return ce("isValidating",!0),Promise.all([pe(),ge(),Ee()]).then((function(e){var r=y.apply(void 0,e);return ce("errors",r),ce("isValidating",!1),r}))}),[pe,ge,Ee,ce]),Re=t.useCallback((function(e){return e?Array.isArray(e)?Promise.all(e.map((function(e){return Ce(e)}))).then((function(e){return!d(e).length})):Ce(e).then((function(e){return!e})):we().then((function(e){return C(e)}))}),[Ce,we]),je=t.useCallback((function(e,r,t){void 0===r&&(r=!0),void 0===t&&(t=x),r?ce("touched."+e,!0):oe("touched","touched."+e,ue.current.touched,e),t&&Ae(e)}),[oe,ce,ue,Ae,x]),Oe=t.useCallback((function(e){return je(e,!0,m?e!==K.current:void 0)}),[je,m]),Ve=t.useCallback((function(e,r){void 0===r&&(r=!0),r?ce("dirty."+e,!0):oe("dirty","dirty."+e,ue.current.dirty,e)}),[oe,ce,ue]),De=t.useCallback((function(e){return Ve(e,p(ue.current.values,e)!==p(te.current.values,e))}),[Ve,ue]),Se=t.useCallback((function(e,r,t){var n=void 0===t?{}:t,u=n.shouldValidate,c=void 0===u?m:u,a=n.shouldTouched,i=void 0===a||a,o=n.shouldDirty,l=void 0===o||o;r=k(r)?r(p(ue.current.values,e)):r,b(r)?oe("values","values."+e,ue.current.values,e):ce("values."+e,r),fe(e,r),i&&je(e,!0,!1),l&&De(e),c&&Ae(e)}),[oe,De,fe,ce,je,ue,Ae,m]),Te=t.useCallback((function(){return{formState:ue.current,setValue:Se,setTouched:je,setDirty:Ve,setError:be,clearErrors:he,runValidation:Re,reset:xe,submit:Le}}),[he,xe,Re,Ve,be,je,Se,ue,Le]),xe=t.useCallback((function(e,r,t){null==t||t.preventDefault(),null==t||t.stopPropagation();var n=a.default({},ue.current),u=o(r||[]);Object.keys(n).forEach((function(r){if(!u[r])if("values"===r){var t=(k(e)?e(ue.current.values):e)||te.current.values;n[r]=t,te.current.values=t,ve(te.current.values,!!e)}else n[r]=te.current[r]})),ce("",n),Z.current(n.values,Te(),t)}),[Te,Z,ve,ce,ue]),Le=t.useCallback((async function(e){null==e||e.preventDefault(),null==e||e.stopPropagation();var r=Object.keys(a.default({},z.current,H.current)).reduce((function(e,r){return e=O(e,r,!0,!0)}),ue.current.touched);ce("touched",r),ce("isSubmitting",!0);try{var t=await we();return C(t)?(await $.current(ue.current.values,Te(),e),ce("isSubmitted",!0),{values:ue.current.values}):(ee.current(t,Te(),e),{errors:t})}catch(e){throw e}finally{ce("isSubmitting",!1)}}),[Te,ee,$,ce,ue,we]),Pe=t.useCallback((function(e,r){ce("values."+e,r),De(e),m&&Ae(e)}),[De,ce,Ae,m]),Ne=t.useCallback((function(e,r){var t,n=void 0===r?{}:r,u=n.validate,c=n.value,a=n.defaultValue,i=n.parse,o=n.format,l=n.onChange,s=n.onBlur;if(e){H.current[e]=!0,u&&(Y.current[e]=u);var f=p(re.current,e);return a=b(f)?a:f,b(a)||de(e,a),c=b(c)?ye("values."+e):c,c=null!=(t=o?o(c):c)?t:"",{name:e,value:c,onChange:function(){for(var r,t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];if(i)r=i.apply(void 0,n);else{var c=n[0];r=(null==c?void 0:c.nativeEvent)instanceof Event&&A(c.target)?se(e):c}Pe(e,r),l&&l.apply(void 0,n.concat([r])),K.current=e},onBlur:function(r){Oe(e),s&&s(r),K.current=void 0}}}}),[se,ye,Pe,de,Oe]);return S((function(){X.current&&(z.current=ie(X.current),ve(te.current.values,!0),_.current=!1)}),[ie,ve]),t.useEffect((function(){if(!X.current)return function(){return null};var e=function(e){var r=e.target.name;if(r&&z.current[r]&&!H.current[r]){var t,n=null==(t=G.current[r])?void 0:t.parse,u=se(r);Pe(r,n?n(u):u),K.current=r}},r=function(e){var r=e.target;if(A(r)){var t=r.name;z.current[t]&&!H.current[t]&&(Oe(t),K.current=void 0)}},t=function(e){return Le(e)},n=function(e){return xe(null,null,e)},u=X.current;u.addEventListener("input",e),u.addEventListener("focusout",r),u.addEventListener("submit",t),u.addEventListener("reset",n);var c=new MutationObserver((function(e){if("childList"===e[0].type){var r=ie(u),t=ue.current.values;q&&Object.keys(z.current).forEach((function(e){r[e]||(oe("values","values."+e,ue.current.values,e),oe("touched","touched."+e,ue.current.touched,e),oe("dirty","dirty."+e,ue.current.dirty,e),oe("errors","errors."+e,ue.current.errors,e),ae(e,!0),te.current.values=V(te.current.values,e,!0),delete G.current[e],delete Y.current[e],delete H.current[e])}));var n=[];Object.keys(r).forEach((function(e){if(!z.current[e]&&!H.current[e]){var r=p(re.current,e);b(r)||(t=O(t,e,r,!0)),n.push(e)}})),z.current=r,n.length&&ve(t,!0,n)}}));return c.observe(u,{childList:!0,subtree:!0}),function(){u.removeEventListener("input",e),u.removeEventListener("focusout",r),u.removeEventListener("submit",t),u.removeEventListener("reset",n),c.disconnect()}}),[ie,se,Pe,oe,xe,ve,Oe,ae,q,ue,Le]),{form:X,field:le,getState:ye,setValue:Se,setTouched:je,setDirty:Ve,setError:be,clearErrors:he,runValidation:Re,reset:xe,submit:Le,controller:Ne}};
//# sourceMappingURL=index.cjs.production.min.js.map
