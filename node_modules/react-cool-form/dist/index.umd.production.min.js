!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).ReactCoolForm={},e.React)}(this,(function(e,r){"use strict";function t(){return(t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var n=Object.prototype.hasOwnProperty;function u(e,r){var t,c;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((c=e.length)===r.length)for(;c--&&u(e[c],r[c]););return-1===c}if(!t||"object"==typeof e){for(t in c=0,e){if(n.call(e,t)&&++c&&!n.call(r,t))return!1;if(!(t in r)||!u(e[t],r[t]))return!1}return Object.keys(r).length===c}}return e!=e&&r!=r}var c=function(e){var t=r.useRef(e);return r.useEffect((function(){t.current=e})),t},i=function(e){return e.reduce((function(e,r){return e[r]=!0,e}),{})},a=function(e){return null!==e&&"object"==typeof e},o=function(e){return e instanceof FileList},s=function e(r){if(r instanceof Event)throw new Error("Unable to clone event.");if(!a(r)||o(r))return r;if(r instanceof Date)return new Date(r.getTime());if(Array.isArray(r))return r.map((function(r){return e(r)}));if(a(r))return Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{});throw new Error("Unable to clone object.")},l=function(e){return e.filter(Boolean)},f=function(e){return!Array.isArray(e)&&!(e instanceof Date)&&a(e)},v=function e(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],c=t[n];Array.isArray(u)&&Array.isArray(c)?r[n]=[].concat(u,c):f(u)&&f(c)?r[n]=e(u,c):r[n]=c})),r}),{})},d=function(e){return void 0===e},y=function e(r,t){return f(r)?Object.keys(r).reduce((function(n,u){var c=e(r[u],t[u]||!1);return d(c)?delete n[u]:n[u]=c,n}),{}):t?r:void 0},h=function(e){if("string"!=typeof e)throw new TypeError("Expected a string.");return e.length?l(e.split(/[.[\]]+/)):[]},b=function(e,r,t){if(!f(e)||!r)return t;var n=h(r).reduce((function(e,r){return(e||{})[r]}),e);return d(n)?t:n},p=function(e){return"function"==typeof e},m=function(e){return p(e)&&"AsyncFunction"===e.constructor.name},g=function(e){return"checkbox"===e.type},k=function(e){return f(e)&&!Object.keys(e).length},E=function(e){return/INPUT|TEXTAREA|SELECT/.test(e.tagName)},C=function(e){return"file"===e.type},A=function(e){return"select-multiple"===e.type},w=function(e){return"radio"===e.type},O=function(e,r,t,n){if(void 0===n&&(n=!1),!f(e))throw new TypeError("Expected an object.");var u=h(r),c=n?s(e):e;return u.slice(0,-1).reduce((function(e,r,t){var n=!Number.isNaN(Number(u[t+1]));return f(e[r])&&!n||(e[r]=n?[]:{}),e[r]}),c)[u[u.length-1]||""]=t,c},j=function(e,r,t){if(void 0===t&&(t=!1),!f(e))throw new TypeError("Expected an object.");var n=t?s(e):e,u=n;if(u.hasOwnProperty(r))return delete u[r],n;var c=h(r);if(!c.length)return n;var i=c.pop(),o=c.reduce((function(e,r){return(e||{})[r]}),u);return a(o)&&o.hasOwnProperty(i)&&delete o[i],n},R=function(e,n){var i=r.useReducer((function(e){return e+1}),0)[1],a=r.useRef(e),o=r.useRef({}),s=c(n||function(){}),l=r.useCallback((function(e,r,n){var c=void 0===n?{}:n,l=c.fieldPath,v=c.shouldUpdate,d=void 0===v||v,y=e.split(".")[0];if(y){if("values"!==e&&"values"===y||!u(b(a.current,e),r)){var h=O(a.current,e,r,!0),p=h.errors,m=h.dirty,g=h.isDirty,E=h.isValid,C=h.submitCount,A="dirty"===y?function(e){return!!function e(r,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(r);n<u.length;n++){var c=u[n];if(!0===c)return t.push(c),t;f(c)&&e(c,t)}return t}(e).length}(m):g,w="errors"===y?k(p):E,j="isSubmitting"===y&&r?C+=1:C;a.current=t({},h,{isDirty:A,isValid:w,submitCount:j}),e=l||e,d&&(Object.keys(o.current).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||o.current.isDirty&&A!==g||o.current.isValid&&w!==E)&&(i(),s.current(a.current))}}else u(a.current,r)||(a.current=r,i(),s.current(a.current))}),[s]),v=r.useCallback((function(e,r){void 0===r&&(r=!1),r?delete o.current[e]:o.current[e]=!0}),[]);return{stateRef:a,setStateRef:l,setUsedStateRef:v}},T="undefined"==typeof window?r.useEffect:r.useLayoutEffect;e.get=b,e.set=O,e.unset=j,e.useForm=function(e){var n=void 0===e?{}:e,u=n.defaultValues,a=void 0===u?{}:u,s=n.validate,h=n.validateOnChange,S=void 0===h||h,D=n.validateOnBlur,V=void 0===D||D,P=n.builtInValidationMode,x=void 0===P?"message":P,L=n.shouldRemoveField,N=void 0===L||L,U=n.excludeFields,F=void 0===U?[]:U,M=n.onReset,B=n.onSubmit,I=n.onError,W=n.debug,q=r.useRef(!0),_=r.useRef(null),X=r.useRef({}),z=r.useRef({}),G=r.useRef({}),H=r.useRef(i(F)),J=r.useRef(),K=c(s),Q=r.useRef({}),Y=c(M||function(){}),Z=c(B||function(){}),$=c(I||function(){}),ee=r.useRef(a),re=r.useRef({values:ee.current,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),te=R(re.current,W),ne=te.stateRef,ue=te.setStateRef,ce=te.setUsedStateRef,ie=r.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e,t=r.type,n=r.name,u=r.dataset.rcfExclude;return!/button|image|submit|reset/.test(t)&&(!(u&&!n)&&(G.current[n]||!(u||H.current[n])))})).reduce((function(e,r){var n=r,u=n.name;return e[u]=t({},e[u],{field:r}),(g(n)||w(n))&&(e[u].options=e[u].options?[].concat(e[u].options,[r]):[r]),e}),{})}),[]),ae=r.useCallback((function(e,r,t,n){return ue(e,j(t,n,!0),{fieldPath:r})}),[ue]),oe=r.useCallback((function(e){return function(r){if(null!=r&&r.name&&!G.current[r.name]&&!H.current[r.name])if(p(e))Q.current[r.name]=e;else{var t=e.validate,n=function(e,r){if(null==e)return{};var t,n,u={},c=Object.keys(e);for(n=0;n<c.length;n++)t=c[n],r.indexOf(t)>=0||(u[t]=e[t]);return u}(e,["validate"]);t&&(Q.current[r.name]=t),z.current[r.name]=n}}}),[]),se=r.useCallback((function(e){var r,t=X.current[e],n=t.field,u=t.options,c=n.value;if("INPUT"===n.tagName){var i,a;if(null!=(i=z.current[e])&&i.valueAsNumber)return c=n.valueAsNumber;if(null!=(a=z.current[e])&&a.valueAsDate)return c=n.valueAsDate}if((function(e){return"number"===e.type}(n)||function(e){return"range"===e.type}(n))&&(c=n.valueAsNumber||""),g(n))if(u){var o=u;c=u.length>1?o.filter((function(e){return e.checked})).map((function(e){return e.value})):o[0].checked}else{var s=b(ne.current.values,n.name);Array.isArray(s)?(s=new Set(s),n.checked?s.add(c):s.delete(c),c=Array.from(s)):c=n.checked}return w(n)&&u&&(c=(null==(r=u.find((function(e){return e.checked})))?void 0:r.value)||""),A(n)&&!u&&(c=Array.from(n.options).filter((function(e){return e.selected})).map((function(e){return e.value}))),C(n)&&(c=n.files),c}),[ne]),le=r.useCallback((function(e,r){if(X.current[e]&&!G.current[e]){var t=X.current[e],n=t.field,u=t.options;if(g(n)){var c=u;c.length>1?c.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):c[0].checked=!!r}else w(n)?u.forEach((function(e){e.checked=e.value===r})):A(n)&&Array.isArray(r)?Array.from(n.options).forEach((function(e){e.selected=!!r.includes(e.value)})):C(n)?(o(r)&&(n.files=r),r||(n.value="")):n.value=null!=r?r:""}}),[]),fe=r.useCallback((function(e,r){d(b(re.current.values,e))&&(re.current.values=O(re.current.values,e,r,!0),ue("values."+e,b(re.current.values,e),{shouldUpdate:!q.current}))}),[ue]),ve=r.useCallback((function(e,r,t){return void 0===r&&(r=!1),void 0===t&&(t=Object.values(X.current)),t.forEach((function(t){var n=f(t)?t.field.name:t;if(!G.current[n]){var u=b(e,n);if(d(u)||le(n,u),r){var c=b(ee.current,n);fe(n,d(c)?se(n):c)}}}))}),[se,fe,le]),de=r.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.target,u=t.watch,c=void 0===u||u,i=t.errorWithTouched,a=void 0!==i&&i;if(e){var o,s=function(e){return e=n?n+"."+e:e,c&&ce(e),e},l=function(e,r){return c&&a&&e.startsWith("errors")&&r&&!k(r)?(e=e.replace("errors","touched"),ce(e),y(r,b(ne.current,e))):r};if(Array.isArray(e))o=e.map((function(e){return e=s(e),l(e,b(ne.current,e))}));else if(f(e)){var v=e;o=Object.keys(v).reduce((function(r,t){return e=s(v[t]),r[t]=l(e,b(ne.current,e)),r}),{})}else e=s(e),o=l(e,b(ne.current,e));return o}}),[ce,ne]),ye=r.useCallback((function(e,r){(r=p(r)?r(b(ne.current.errors,e)):r)?ue("errors."+e,r):ae("errors","errors."+e,ne.current.errors,e)}),[ae,ue,ne]),he=r.useCallback((function(e){e?Array.isArray(e)?e.forEach((function(e){return ae("errors","errors."+e,ne.current.errors,e)})):ae("errors","errors."+e,ne.current.errors,e):ue("errors",{})}),[ae,ue,ne]),be=r.useCallback((function(e){if(!1!==x&&X.current[e]){var r=X.current[e].field;if("message"===x)return r.validationMessage;for(var t in r.validity)if("valid"!==t&&r.validity[t])return t}}),[x]),pe=r.useCallback((function(){return!1===x?{}:Object.keys(X.current).reduce((function(e,r){var n=be(r);return e=t({},e,n?O({},r,n):{})}),{})}),[x,be]),me=r.useCallback((async function(e){if(Q.current[e])try{return await Q.current[e](b(ne.current.values,e),ne.current.values)}catch(e){throw e}}),[ne]),ge=r.useCallback((function(){var e=Object.keys(Q.current).map((function(e){return me(e)}));return Promise.all(e).then((function(e){return Object.keys(Q.current).reduce((function(r,n,u){return r=t({},r,e[u]?O({},n,e[u]):{})}),{})}))}),[me]),ke=r.useCallback((async function(e){if(!K.current)return e?void 0:{};try{var r=await K.current(ne.current.values);return e?b(r,e):f(r)?r:{}}catch(e){throw e}}),[K,ne]),Ee=r.useCallback((async function(e){var r=m(K.current)||m(Q.current[e]);r&&ue("isValidating",!0);try{var t=await ke(e)||await me(e)||be(e);return ye(e,t),r&&ue("isValidating",!1),t}catch(e){return e}}),[K,be,me,ke,ye,ue]),Ce=r.useCallback((function(e){return r=function(){return Ee(e)},(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(r,{timeout:2e3});var r}),[Ee]),Ae=r.useCallback((function(){return ue("isValidating",!0),Promise.all([pe(),ge(),ke()]).then((function(e){var r=v.apply(void 0,e);return ue("errors",r),ue("isValidating",!1),r}))}),[pe,ge,ke,ue]),we=r.useCallback((function(e){return e?Array.isArray(e)?Promise.all(e.map((function(e){return Ee(e)}))).then((function(e){return!l(e).length})):Ee(e).then((function(e){return!e})):Ae().then((function(e){return k(e)}))}),[Ee,Ae]),Oe=r.useCallback((function(e,r,t){void 0===r&&(r=!0),void 0===t&&(t=V),r?ue("touched."+e,!0):ae("touched","touched."+e,ne.current.touched,e),t&&Ce(e)}),[ae,ue,ne,Ce,V]),je=r.useCallback((function(e){return Oe(e,!0,S?e!==J.current:void 0)}),[Oe,S]),Re=r.useCallback((function(e,r){void 0===r&&(r=!0),r?ue("dirty."+e,!0):ae("dirty","dirty."+e,ne.current.dirty,e)}),[ae,ue,ne]),Te=r.useCallback((function(e){return Re(e,b(ne.current.values,e)!==b(re.current.values,e))}),[Re,ne]),Se=r.useCallback((function(e,r,t){var n=void 0===t?{}:t,u=n.shouldValidate,c=void 0===u?S:u,i=n.shouldTouched,a=void 0===i||i,o=n.shouldDirty,s=void 0===o||o;r=p(r)?r(b(ne.current.values,e)):r,d(r)?ae("values","values."+e,ne.current.values,e):ue("values."+e,r),le(e,r),a&&Oe(e,!0,!1),s&&Te(e),c&&Ce(e)}),[ae,Te,le,ue,Oe,ne,Ce,S]),De=r.useCallback((function(){return{formState:ne.current,setValue:Se,setTouched:Oe,setDirty:Re,setError:ye,clearErrors:he,runValidation:we,reset:Ve,submit:Pe}}),[he,Ve,we,Re,ye,Oe,Se,ne,Pe]),Ve=r.useCallback((function(e,r,n){null==n||n.preventDefault(),null==n||n.stopPropagation();var u=t({},ne.current),c=i(r||[]);Object.keys(u).forEach((function(r){if(!c[r])if("values"===r){var t=(p(e)?e(ne.current.values):e)||re.current.values;u[r]=t,re.current.values=t,ve(re.current.values,!!e)}else u[r]=re.current[r]})),ue("",u),Y.current(u.values,De(),n)}),[De,Y,ve,ue,ne]),Pe=r.useCallback((async function(e){null==e||e.preventDefault(),null==e||e.stopPropagation();var r=Object.keys(t({},X.current,G.current)).reduce((function(e,r){return e=O(e,r,!0,!0)}),ne.current.touched);ue("touched",r),ue("isSubmitting",!0);try{var n=await Ae();return k(n)?(await Z.current(ne.current.values,De(),e),ue("isSubmitted",!0),{values:ne.current.values}):($.current(n,De(),e),{errors:n})}catch(e){throw e}finally{ue("isSubmitting",!1)}}),[De,$,Z,ue,ne,Ae]),xe=r.useCallback((function(e,r){ue("values."+e,r),Te(e),S&&Ce(e)}),[Te,ue,Ce,S]),Le=r.useCallback((function(e,r){var t,n=void 0===r?{}:r,u=n.validate,c=n.value,i=n.defaultValue,a=n.parse,o=n.format,s=n.onChange,l=n.onBlur;if(e){G.current[e]=!0,u&&(Q.current[e]=u);var f=b(ee.current,e);return i=d(f)?i:f,d(i)||fe(e,i),c=d(c)?de("values."+e):c,c=null!=(t=o?o(c):c)?t:"",{name:e,value:c,onChange:function(){for(var r,t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];if(a)r=a.apply(void 0,n);else{var c=n[0];r=(null==c?void 0:c.nativeEvent)instanceof Event&&E(c.target)?se(e):c}xe(e,r),s&&s.apply(void 0,n.concat([r])),J.current=e},onBlur:function(r){je(e),l&&l(r),J.current=void 0}}}}),[se,de,xe,fe,je]);return T((function(){_.current&&(X.current=ie(_.current),ve(re.current.values,!0),q.current=!1)}),[ie,ve]),r.useEffect((function(){if(!_.current)return function(){return null};var e=function(e){var r=e.target.name;if(r&&X.current[r]&&!G.current[r]){var t,n=null==(t=z.current[r])?void 0:t.parse,u=se(r);xe(r,n?n(u):u),J.current=r}},r=function(e){var r=e.target;if(E(r)){var t=r.name;X.current[t]&&!G.current[t]&&(je(t),J.current=void 0)}},t=function(e){return Pe(e)},n=function(e){return Ve(null,null,e)},u=_.current;u.addEventListener("input",e),u.addEventListener("focusout",r),u.addEventListener("submit",t),u.addEventListener("reset",n);var c=new MutationObserver((function(e){if("childList"===e[0].type){var r=ie(u),t=ne.current.values;N&&Object.keys(X.current).forEach((function(e){r[e]||(ae("values","values."+e,ne.current.values,e),ae("touched","touched."+e,ne.current.touched,e),ae("dirty","dirty."+e,ne.current.dirty,e),ae("errors","errors."+e,ne.current.errors,e),ce(e,!0),re.current.values=j(re.current.values,e,!0),delete z.current[e],delete Q.current[e],delete G.current[e])}));var n=[];Object.keys(r).forEach((function(e){if(!X.current[e]&&!G.current[e]){var r=b(ee.current,e);d(r)||(t=O(t,e,r,!0)),n.push(e)}})),X.current=r,n.length&&ve(t,!0,n)}}));return c.observe(u,{childList:!0,subtree:!0}),function(){u.removeEventListener("input",e),u.removeEventListener("focusout",r),u.removeEventListener("submit",t),u.removeEventListener("reset",n),c.disconnect()}}),[ie,se,xe,ae,Ve,ve,je,ce,N,ne,Pe]),{form:_,field:oe,getState:de,setValue:Se,setTouched:Oe,setDirty:Re,setError:ye,clearErrors:he,runValidation:we,reset:Ve,submit:Pe,controller:Le}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.production.min.js.map
